# ğŸ’¬ å¯¹è¯æ¡†ç»„ä»¶

**qt_dialogs æ¨¡å—è¯¦è§£**

---

## ğŸ“‹ æ¨¡å—æ¦‚è¿°

qt_dialogs æ¨¡å—æä¾›äº†é¡¹ç›®ä¸­ä½¿ç”¨çš„å„ç§å¯¹è¯æ¡†ç»„ä»¶ï¼Œç»Ÿä¸€å¤„ç†ç”¨æˆ·äº¤äº’ã€‚

### å¯¹è¯æ¡†ç±»å‹

| ç±»å‹ | ç”¨é€” |
|------|------|
| LoadingDialog | åŠ è½½ç­‰å¾…æç¤º |
| ProgressDialog | è¿›åº¦æ¡å¯¹è¯æ¡† |
| InputDialog | æ–‡æœ¬è¾“å…¥å¯¹è¯æ¡† |
| ConfirmDialog | ç¡®è®¤å¯¹è¯æ¡† |
| ErrorDialog | é”™è¯¯æç¤ºå¯¹è¯æ¡† |
| InfoDialog | ä¿¡æ¯æç¤ºå¯¹è¯æ¡† |
| FileSelectDialog | æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡† |
| SheetSelectDialog | Sheeté€‰æ‹©å¯¹è¯æ¡† |

---

## â³ LoadingDialog

### åŠŸèƒ½

æ˜¾ç¤ºåŠ è½½åŠ¨ç”»ï¼Œç”¨äºé•¿æ—¶é—´æ“ä½œã€‚

### ç•Œé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                     â”‚
â”‚           â³ æ­£åœ¨å¤„ç†...            â”‚
â”‚                                     â”‚
â”‚        [========>    ] 60%          â”‚
â”‚                                     â”‚
â”‚           è¯·ç¨å€™...                 â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä½¿ç”¨æ–¹å¼

```python
from ui.qt_dialogs import LoadingDialog

# åˆ›å»ºå¹¶æ˜¾ç¤º
loading = LoadingDialog(parent, "æ­£åœ¨å¤„ç†æ•°æ®...")
loading.show()

# æ‰§è¡Œæ“ä½œ
process_data()

# å…³é—­
loading.close()
```

### å¸¦ä¸Šä¸‹æ–‡ç®¡ç†å™¨

```python
from ui.qt_dialogs import loading_context

with loading_context(parent, "æ­£åœ¨å¯¼å‡º..."):
    export_data()
```

---

## ğŸ“Š ProgressDialog

### åŠŸèƒ½

æ˜¾ç¤ºå¸¦è¿›åº¦æ¡çš„å¯¹è¯æ¡†ï¼Œç”¨äºå¯è·Ÿè¸ªè¿›åº¦çš„æ“ä½œã€‚

### ç•Œé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å¯¼å‡ºè¿›åº¦                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚   å¤„ç†è¡Œ: 5000 / 10000              â”‚
â”‚                                     â”‚
â”‚   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 50%      â”‚
â”‚                                     â”‚
â”‚              [å–æ¶ˆ]                 â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä½¿ç”¨æ–¹å¼

```python
from ui.qt_dialogs import ProgressDialog

progress = ProgressDialog(parent, "å¯¼å‡ºè¿›åº¦", max_value=100)
progress.show()

for i in range(100):
    process_item(i)
    progress.set_value(i + 1)
    progress.set_text(f"å¤„ç†è¡Œ: {i + 1} / 100")
    
    if progress.was_cancelled():
        break

progress.close()
```

### API

| æ–¹æ³• | å‚æ•° | è¯´æ˜ |
|------|------|------|
| `set_value()` | int | è®¾ç½®å½“å‰è¿›åº¦å€¼ |
| `set_text()` | str | è®¾ç½®æ˜¾ç¤ºæ–‡æœ¬ |
| `was_cancelled()` | - | æ£€æŸ¥æ˜¯å¦è¢«å–æ¶ˆ |
| `set_max()` | int | è®¾ç½®æœ€å¤§å€¼ |

---

## âœï¸ InputDialog

### åŠŸèƒ½

è·å–ç”¨æˆ·æ–‡æœ¬è¾“å…¥ã€‚

### ç•Œé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ä¿å­˜æ¨¡æ¿                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚   è¯·è¾“å…¥æ¨¡æ¿åç§°:                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ ASNå¯¹è´¦-æ ‡å‡†æ¨¡æ¿            â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚         [å–æ¶ˆ]    [ç¡®å®š]            â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä½¿ç”¨æ–¹å¼

```python
from ui.qt_dialogs import InputDialog

dialog = InputDialog(
    parent,
    title="ä¿å­˜æ¨¡æ¿",
    label="è¯·è¾“å…¥æ¨¡æ¿åç§°:",
    default_value="æ–°æ¨¡æ¿"
)

if dialog.exec() == QDialog.DialogCode.Accepted:
    name = dialog.get_value()
    save_template(name)
```

### ä¾¿æ·å‡½æ•°

```python
from ui.qt_dialogs import get_input

name = get_input(
    parent,
    title="ä¿å­˜æ¨¡æ¿",
    label="è¯·è¾“å…¥æ¨¡æ¿åç§°:",
    default="æ–°æ¨¡æ¿"
)

if name:
    save_template(name)
```

---

## â“ ConfirmDialog

### åŠŸèƒ½

è¯·æ±‚ç”¨æˆ·ç¡®è®¤æ“ä½œã€‚

### ç•Œé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ç¡®è®¤åˆ é™¤                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚   âš ï¸ ç¡®å®šè¦åˆ é™¤æ¨¡æ¿ "ASNå¯¹è´¦" å—ï¼Ÿ  â”‚
â”‚                                     â”‚
â”‚   æ­¤æ“ä½œä¸å¯æ¢å¤ã€‚                  â”‚
â”‚                                     â”‚
â”‚         [å–æ¶ˆ]    [ç¡®å®š]            â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä½¿ç”¨æ–¹å¼

```python
from ui.qt_dialogs import ConfirmDialog

dialog = ConfirmDialog(
    parent,
    title="ç¡®è®¤åˆ é™¤",
    message="ç¡®å®šè¦åˆ é™¤æ¨¡æ¿ \"ASNå¯¹è´¦\" å—ï¼Ÿ\næ­¤æ“ä½œä¸å¯æ¢å¤ã€‚"
)

if dialog.exec() == QDialog.DialogCode.Accepted:
    delete_template()
```

### ä¾¿æ·å‡½æ•°

```python
from ui.qt_dialogs import confirm

if confirm(parent, "ç¡®è®¤åˆ é™¤", "ç¡®å®šè¦åˆ é™¤å—ï¼Ÿ"):
    delete_template()
```

---

## âŒ ErrorDialog

### åŠŸèƒ½

æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ã€‚

### ç•Œé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         âŒ é”™è¯¯                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚   å¯¼å…¥å¤±è´¥                          â”‚
â”‚                                     â”‚
â”‚   æ‰‹å·¥è¡¨ç¼ºå°‘å¿…å¡«åˆ—ï¼šè®¢å•ç¼–å·        â”‚
â”‚                                     â”‚
â”‚   è¯·æ£€æŸ¥Excelæ–‡ä»¶æ˜¯å¦æ­£ç¡®ã€‚         â”‚
â”‚                                     â”‚
â”‚              [ç¡®å®š]                 â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä½¿ç”¨æ–¹å¼

```python
from ui.qt_dialogs import show_error

show_error(
    parent,
    title="å¯¼å…¥å¤±è´¥",
    message="æ‰‹å·¥è¡¨ç¼ºå°‘å¿…å¡«åˆ—ï¼šè®¢å•ç¼–å·\n\nè¯·æ£€æŸ¥Excelæ–‡ä»¶æ˜¯å¦æ­£ç¡®ã€‚"
)
```

### è¯¦ç»†é”™è¯¯

```python
from ui.qt_dialogs import show_error_detail

show_error_detail(
    parent,
    title="å¤„ç†å¤±è´¥",
    message="æ•°æ®å¤„ç†æ—¶å‘ç”Ÿé”™è¯¯",
    detail=traceback.format_exc()
)
```

---

## â„¹ï¸ InfoDialog

### åŠŸèƒ½

æ˜¾ç¤ºæç¤ºä¿¡æ¯ã€‚

### ç•Œé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         â„¹ï¸ æç¤º                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚   å¯¼å‡ºæˆåŠŸ                          â”‚
â”‚                                     â”‚
â”‚   æ–‡ä»¶å·²ä¿å­˜è‡³:                     â”‚
â”‚   D:\exports\å¯¹è´¦ç»“æœ_20260111.xlsx â”‚
â”‚                                     â”‚
â”‚              [ç¡®å®š]                 â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä½¿ç”¨æ–¹å¼

```python
from ui.qt_dialogs import show_info

show_info(
    parent,
    title="å¯¼å‡ºæˆåŠŸ",
    message=f"æ–‡ä»¶å·²ä¿å­˜è‡³:\n{file_path}"
)
```

---

## ğŸ“ FileSelectDialog

### åŠŸèƒ½

é€‰æ‹©æ–‡ä»¶æˆ–ç›®å½•ã€‚

### æ–‡ä»¶é€‰æ‹©

```python
from ui.qt_dialogs import select_file

file_path = select_file(
    parent,
    title="é€‰æ‹©Excelæ–‡ä»¶",
    filter="Excelæ–‡ä»¶ (*.xlsx *.xls *.xlsm)",
    directory="D:/data"
)

if file_path:
    load_file(file_path)
```

### ä¿å­˜æ–‡ä»¶

```python
from ui.qt_dialogs import save_file

file_path = save_file(
    parent,
    title="ä¿å­˜ç»“æœ",
    filter="Excelæ–‡ä»¶ (*.xlsx)",
    default_name="å¯¹è´¦ç»“æœ.xlsx"
)

if file_path:
    export_to_file(file_path)
```

### é€‰æ‹©ç›®å½•

```python
from ui.qt_dialogs import select_directory

dir_path = select_directory(
    parent,
    title="é€‰æ‹©å¯¼å‡ºç›®å½•"
)

if dir_path:
    export_to_directory(dir_path)
```

---

## ğŸ“‹ SheetSelectDialog

### åŠŸèƒ½

ä»å¤šSheetçš„Excelæ–‡ä»¶ä¸­é€‰æ‹©Sheetã€‚

### ç•Œé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         é€‰æ‹©å·¥ä½œè¡¨                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚   æ–‡ä»¶åŒ…å«å¤šä¸ªå·¥ä½œè¡¨ï¼Œè¯·é€‰æ‹©:       â”‚
â”‚                                     â”‚
â”‚   â—‹ Sheet1                          â”‚
â”‚   â— æ‰§è¡ŒæŠ¥è¡¨                        â”‚
â”‚   â—‹ æ±‡æ€»                            â”‚
â”‚   â—‹ è¯´æ˜                            â”‚
â”‚                                     â”‚
â”‚         [å–æ¶ˆ]    [ç¡®å®š]            â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä½¿ç”¨æ–¹å¼

```python
from ui.qt_dialogs import SheetSelectDialog

sheets = ["Sheet1", "æ‰§è¡ŒæŠ¥è¡¨", "æ±‡æ€»", "è¯´æ˜"]

dialog = SheetSelectDialog(parent, sheets)
if dialog.exec() == QDialog.DialogCode.Accepted:
    selected = dialog.get_selected()
    load_sheet(selected)
```

---

## ğŸ¨ æ ·å¼è§„èŒƒ

### å¯¹è¯æ¡†åŸºç¡€æ ·å¼

```python
DIALOG_STYLE = """
    QDialog {
        background-color: #ffffff;
        border: 1px solid #cccccc;
        border-radius: 8px;
    }
    QLabel {
        color: #333333;
    }
    QPushButton {
        background-color: #f5f5f5;
        color: #333333;
        border: 1px solid #cccccc;
        border-radius: 4px;
        padding: 8px 16px;
        min-width: 80px;
    }
    QPushButton:hover {
        background-color: #e0e0e0;
        border-color: #2196F3;
    }
    QPushButton[primary="true"] {
        background-color: #1976D2;
        color: #ffffff;
        border: none;
    }
    QPushButton[primary="true"]:hover {
        background-color: #1565C0;
    }
"""
```

### æŒ‰é’®è§„èŒƒ

| æŒ‰é’®ç±»å‹ | èƒŒæ™¯è‰² | æ–‡å­—è‰² | ç”¨é€” |
|---------|--------|--------|------|
| ä¸»æŒ‰é’® | #1976D2 | #ffffff | ç¡®å®šã€ä¿å­˜ |
| æ¬¡æŒ‰é’® | #f5f5f5 | #333333 | å–æ¶ˆã€å…³é—­ |
| å±é™©æŒ‰é’® | #f44336 | #ffffff | åˆ é™¤ |

---

## ğŸ’» æŠ€æœ¯å®ç°

### åŸºç¡€å¯¹è¯æ¡†ç±»

```python
class BaseDialog(QDialog):
    def __init__(self, parent, title):
        super().__init__(parent)
        self.setWindowTitle(title)
        self.setModal(True)
        self.setStyleSheet(DIALOG_STYLE)
        self._init_ui()
    
    def _init_ui(self):
        """å­ç±»å®ç°"""
        pass
    
    def _create_buttons(self, ok_text="ç¡®å®š", cancel_text="å–æ¶ˆ"):
        """åˆ›å»ºæ ‡å‡†æŒ‰é’®"""
        layout = QHBoxLayout()
        
        self.btn_cancel = QPushButton(cancel_text)
        self.btn_cancel.clicked.connect(self.reject)
        
        self.btn_ok = QPushButton(ok_text)
        self.btn_ok.setProperty("primary", True)
        self.btn_ok.clicked.connect(self.accept)
        
        layout.addStretch()
        layout.addWidget(self.btn_cancel)
        layout.addWidget(self.btn_ok)
        
        return layout
```

### LoadingDialog å®ç°

```python
class LoadingDialog(QDialog):
    def __init__(self, parent, message="æ­£åœ¨å¤„ç†..."):
        super().__init__(parent)
        self.setWindowTitle("è¯·ç¨å€™")
        self.setModal(True)
        self.setWindowFlags(
            Qt.WindowType.Dialog | 
            Qt.WindowType.FramelessWindowHint
        )
        
        layout = QVBoxLayout(self)
        
        # åŠ è½½åŠ¨ç”»
        self.spinner = QLabel("â³")
        self.spinner.setAlignment(Qt.AlignmentFlag.AlignCenter)
        
        # æ¶ˆæ¯
        self.message = QLabel(message)
        self.message.setAlignment(Qt.AlignmentFlag.AlignCenter)
        
        layout.addWidget(self.spinner)
        layout.addWidget(self.message)
        
        self.setFixedSize(200, 100)
    
    def set_message(self, message):
        self.message.setText(message)
```

---

## ğŸ“ ä½¿ç”¨è§„èŒƒ

### é”™è¯¯å¤„ç†

```python
try:
    result = process_data()
except FileNotFoundError:
    show_error(self, "æ–‡ä»¶ä¸å­˜åœ¨", "è¯·æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®ã€‚")
except PermissionError:
    show_error(self, "æ–‡ä»¶è¢«å ç”¨", "è¯·å…³é—­æ–‡ä»¶åé‡è¯•ã€‚")
except Exception as e:
    show_error_detail(self, "å¤„ç†å¤±è´¥", str(e), traceback.format_exc())
```

### ç¡®è®¤åˆ é™¤

```python
if confirm(self, "ç¡®è®¤åˆ é™¤", f"ç¡®å®šè¦åˆ é™¤æ¨¡æ¿ \"{name}\" å—ï¼Ÿ"):
    storage.delete_template(template_id)
    show_info(self, "åˆ é™¤æˆåŠŸ", "æ¨¡æ¿å·²åˆ é™¤ã€‚")
```

### å¸¦åŠ è½½çš„æ“ä½œ

```python
def export(self):
    loading = LoadingDialog(self, "æ­£åœ¨å¯¼å‡º...")
    loading.show()
    QApplication.processEvents()  # ç¡®ä¿æ˜¾ç¤º
    
    try:
        ExportEngine.export_results(...)
        loading.close()
        show_info(self, "å¯¼å‡ºæˆåŠŸ", f"æ–‡ä»¶å·²ä¿å­˜è‡³:\n{path}")
    except Exception as e:
        loading.close()
        show_error(self, "å¯¼å‡ºå¤±è´¥", str(e))
```

---

## â–¶ï¸ ä¸‹ä¸€æ­¥

äº†è§£æ ¸å¿ƒå¼•æ“APIï¼ŒæŸ¥çœ‹ [æ ¸å¿ƒå¼•æ“API](./14-æ ¸å¿ƒå¼•æ“API.md)ã€‚
