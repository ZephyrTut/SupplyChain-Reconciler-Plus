# SupplyChain-Reconciler-Plus v1.4.2 æ›´æ–°è¯´æ˜

**å‘å¸ƒæ—¥æœŸ**: 2025å¹´1æœˆ8æ—¥

---

## ğŸ¯ æœ¬æ¬¡æ›´æ–°é‡ç‚¹

æœ¬æ¬¡æ›´æ–°ä»å†å²ç‰ˆæœ¬ (result_preview_20251217233112.py) ä¸­æå–äº†**å…¬å¼æ˜¾ç¤ºå’Œåˆ—å­—æ¯æ˜ å°„**é€»è¾‘ï¼Œå¹¶è¿ç§»åˆ° PyQt6 æ¡†æ¶ï¼Œå¢å¼ºäº†ç”¨æˆ·å¯¹å·®å€¼è®¡ç®—è¿‡ç¨‹çš„ç†è§£ã€‚

---

## âœ¨ æ–°å¢åŠŸèƒ½

### 1. å®Œæ•´çš„å…¬å¼æ˜¾ç¤ºç³»ç»Ÿ

#### 1.1 åˆ—å­—æ¯è‡ªåŠ¨åˆ†é…
- **Excelé£æ ¼åˆ—å­—æ¯**: è‡ªåŠ¨ä¸ºæ¯åˆ—åˆ†é…å­—æ¯ (A, B, C, ... Z, AA, AB, ...)
- **åˆ†é…é¡ºåº**: æŒ‰ç…§å¯¼å‡ºExcelçš„åˆ—é¡ºåº
  - é€è§†åˆ—ï¼ˆæŒ‰å­—æ¯é¡ºåºï¼‰
  - ç³»ç»Ÿæ€»è®¡
  - æ‰‹å·¥æ•°é‡
  - å·®å€¼
  - æ¯”å¯¹çŠ¶æ€

#### 1.2 å…¬å¼æ˜¾ç¤ºï¼ˆæ­¥éª¤2 - æ•°æ®é¢„è§ˆï¼‰
æ–°å¢é»„è‰²å…¬å¼æ˜¾ç¤ºåŒºåŸŸï¼Œæ˜¾ç¤ºï¼š

**ç¬¬ä¸€è¡Œ - å·®å€¼å…¬å¼**:
```
å·®å€¼å…¬å¼: C - (B + A)  (åŸå§‹: M - (S - å·²å®Œæˆ))
```
- å·¦ä¾§: å®é™…Excelåˆ—å­—æ¯çš„å…¬å¼
- å³ä¾§: åŸå§‹é…ç½®çš„å…¬å¼ï¼ˆM/S/é€è§†åˆ—åï¼‰

**ç¬¬äºŒè¡Œ - åˆ—å¯¹ç…§**:
```
åˆ—å¯¹ç…§: A=å·²å®Œæˆ, B=å¤„ç†ä¸­, C=æ‰‹å·¥æ•°é‡, D=ç³»ç»Ÿæ€»è®¡
```
- æ˜¾ç¤ºæ‰€æœ‰åˆ—çš„å­—æ¯ä¸åç§°æ˜ å°„å…³ç³»

#### 1.3 å¢å¼ºçš„è¡¨å¤´æ˜¾ç¤º
è¡¨å¤´ä»å•çº¯çš„åˆ—åæ”¹ä¸ºï¼š
```
[ä¹‹å‰] æ‰‹å·¥æ•°é‡ | å·²å®Œæˆ | å¤„ç†ä¸­ | ç³»ç»Ÿæ€»è®¡
[ç°åœ¨] C (æ‰‹å·¥æ•°é‡) | A (å·²å®Œæˆ) | B (å¤„ç†ä¸­) | D (ç³»ç»Ÿæ€»è®¡)
```

### 2. æ­¥éª¤3ç»“æœè¡¨æ ¼å¢å¼º

#### 2.1 å…¬å¼æ˜¾ç¤ºåŒºåŸŸ
åœ¨ç»“æœè¡¨æ ¼ä¸Šæ–¹æ–°å¢é»„è‰²å…¬å¼åŒºåŸŸï¼ˆåŒæ­¥éª¤2ï¼‰ï¼Œä¾¿äºå¯¹è´¦åå›é¡¾å…¬å¼ã€‚

#### 2.2 åˆ—å­—æ¯è¡¨å¤´
ç»“æœè¡¨æ ¼è¡¨å¤´ä¹Ÿä½¿ç”¨å­—æ¯æ ‡æ³¨ï¼Œä¸Excelå¯¼å‡ºä¿æŒä¸€è‡´ã€‚

#### 2.3 æ•°å€¼æ ¼å¼åŒ–
- æ•´æ•°ï¼šæ˜¾ç¤ºä¸ºæ•´æ•°ï¼ˆ100 è€Œé 100.00ï¼‰
- å°æ•°ï¼šä¿ç•™2ä½æœ‰æ•ˆæ•°å­—å¹¶å»é™¤å°¾é›¶ï¼ˆ1.5 è€Œé 1.50ï¼‰
- ç©ºå€¼ï¼šæ˜¾ç¤ºä¸ºç©ºå­—ç¬¦ä¸²

---

## ğŸ”§ æŠ€æœ¯æ”¹è¿›

### ä»£ç è¿ç§»
ä»å†å² ttkbootstrap ç‰ˆæœ¬è¿ç§»ä»¥ä¸‹æ ¸å¿ƒé€»è¾‘åˆ° PyQt6:

#### 1. `_excel_col_letter(n)` æ–¹æ³•
```python
def _excel_col_letter(self, n: int) -> str:
    """ç”ŸæˆExcelåˆ—å­—æ¯ï¼ˆA, B, C, ... Z, AA, AB, ...ï¼‰"""
    result = ""
    while n >= 0:
        result = chr(n % 26 + 65) + result
        n = n // 26 - 1
    return result
```

#### 2. `_update_formula_display()` æ–¹æ³•
- ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ›¿æ¢å…¬å¼ä¸­çš„å˜é‡
- `\bM\b` â†’ æ‰‹å·¥æ•°é‡åˆ—å­—æ¯
- `\bS\b` â†’ ç³»ç»Ÿæ€»è®¡åˆ—å­—æ¯
- é€è§†åˆ—å â†’ å¯¹åº”åˆ—å­—æ¯

#### 3. åˆ—å­—æ¯æ˜ å°„ç”Ÿæˆ
```python
self.column_letters.clear()
col_index = 0

# é€è§†åˆ—ï¼ˆæŒ‰å­—æ¯é¡ºåºï¼‰
for pv in sorted(pivot_values):
    self.column_letters[pv] = self._excel_col_letter(col_index)
    col_index += 1

# ç³»ç»Ÿæ€»è®¡
self.column_letters["ç³»ç»Ÿæ€»è®¡"] = self._excel_col_letter(col_index)
col_index += 1

# æ‰‹å·¥æ•°é‡
self.column_letters["æ‰‹å·¥æ•°é‡"] = self._excel_col_letter(col_index)
```

---

## ğŸ“ æ–‡ä»¶ä¿®æ”¹æ¸…å•

### ä¿®æ”¹æ–‡ä»¶
1. **ui/qt_result_preview.py**
   - æ–°å¢: `_excel_col_letter()` æ–¹æ³•
   - æ–°å¢: `_update_formula_display()` æ–¹æ³•
   - ä¿®æ”¹: `QtResultPreview.__init__()` - æ·»åŠ  column_letters å±æ€§
   - ä¿®æ”¹: `QtResultPreview._setup_ui()` - æ–°å¢å…¬å¼æ˜¾ç¤ºåŒºåŸŸ
   - ä¿®æ”¹: `QtResultPreview.update_preview()` - ç”Ÿæˆåˆ—å­—æ¯æ˜ å°„
   - ä¿®æ”¹: `QtResultPreview.clear()` - æ¸…ç©ºåˆ—å­—æ¯æ˜ å°„
   - ä¿®æ”¹: `QtResultTable.__init__()` - æ·»åŠ  column_letters å±æ€§
   - ä¿®æ”¹: `QtResultTable._setup_ui()` - æ–°å¢å…¬å¼æ˜¾ç¤ºåŒºåŸŸ
   - ä¿®æ”¹: `QtResultTable.set_data()` - ç”Ÿæˆåˆ—å­—æ¯è¡¨å¤´å’Œå…¬å¼
   - æ–°å¢: `QtResultTable._update_formula_display()` æ–¹æ³•
   - ä¿®æ”¹: `QtResultTable.clear()` - æ¸…ç©ºå…¬å¼æ˜¾ç¤º

2. **ui/qt_main_window.py**
   - ä¿®æ”¹: `_execute_compare()` - ä¼ é€’ config å‚æ•°åˆ° result_table.set_data()

---

## ğŸ“Š ä½¿ç”¨ç¤ºä¾‹

### åœºæ™¯ï¼šè®¢å•å¯¹è´¦ï¼ˆå«é€è§†åˆ—ï¼‰

#### é…ç½®
- **ä¸»é”®**: è®¢å•ç¼–å· + ç‰©æ–™ç¼–ç 
- **æ‰‹å·¥æ•°é‡åˆ—**: æ‰‹å·¥æ•°é‡
- **ç³»ç»Ÿæ•°é‡åˆ—**: ç³»ç»Ÿæ•°é‡
- **é€è§†åˆ—**: è®¢å•çŠ¶æ€ï¼ˆå·²å®Œæˆã€å¤„ç†ä¸­ã€å¾…å®¡æ ¸ï¼‰
- **å·®å€¼å…¬å¼**: `M - (S - å·²å®Œæˆ)`

#### æ­¥éª¤2é¢„è§ˆæ˜¾ç¤º

**å…¬å¼åŒºåŸŸ**:
```
å·®å€¼å…¬å¼: C - (D - A)  (åŸå§‹: M - (S - å·²å®Œæˆ))
åˆ—å¯¹ç…§: A=å·²å®Œæˆ, B=å¤„ç†ä¸­, C=æ‰‹å·¥æ•°é‡, D=ç³»ç»Ÿæ€»è®¡
```

**è¡¨å¤´**:
```
| KEY         | A (å·²å®Œæˆ) | B (å¤„ç†ä¸­) | C (æ‰‹å·¥æ•°é‡) | D (ç³»ç»Ÿæ€»è®¡) |
```

#### æ­¥éª¤3ç»“æœè¡¨æ ¼

**å…¬å¼åŒºåŸŸ** (åŒæ­¥éª¤2):
```
å·®å€¼å…¬å¼: C - (D - A)  (åŸå§‹: M - (S - å·²å®Œæˆ))
åˆ—å¯¹ç…§: A=å·²å®Œæˆ, B=å¤„ç†ä¸­, C=æ‰‹å·¥æ•°é‡, D=ç³»ç»Ÿæ€»è®¡
```

**è¡¨å¤´**:
```
| KEY         | A (å·²å®Œæˆ) | B (å¤„ç†ä¸­) | D (ç³»ç»Ÿæ€»è®¡) | C (æ‰‹å·¥æ•°é‡) | å·®å€¼ | æ¯”å¯¹çŠ¶æ€ |
```

---

## ğŸ¨ UIå˜åŒ–

### æ­¥éª¤2 - æ•°æ®é¢„è§ˆé¢æ¿
**æ–°å¢åŒºåŸŸ**:
- é»„è‰²èƒŒæ™¯å…¬å¼æ¡†ï¼ˆ`#fff9e6`ï¼‰
- æ©™è‰²æ–‡å­—å…¬å¼æ ‡ç­¾ï¼ˆ`#f57c00`ï¼‰
- ç°è‰²åˆ—å¯¹ç…§è¯´æ˜ï¼ˆ`#666`ï¼‰

### æ­¥éª¤3 - ç»“æœè¡¨æ ¼
**æ–°å¢åŒºåŸŸ**:
- åŒæ­¥éª¤2çš„å…¬å¼æ¡†
- è¡¨å¤´æ˜¾ç¤ºåˆ—å­—æ¯

---

## ğŸ”„ è¿ç§»è¯´æ˜

### ä»å†å²ç‰ˆæœ¬æå–çš„é€»è¾‘

#### æºæ–‡ä»¶
`.history/ui/result_preview_20251217233112.py` (ttkbootstrapç‰ˆæœ¬)

#### æå–å†…å®¹
1. **_excel_col_letter() æ–¹æ³•** (ç¬¬172-178è¡Œ)
2. **_update_formula_label() æ–¹æ³•** (ç¬¬323-350è¡Œ)
   - é‡å‘½åä¸º: `_update_formula_display()`
   - é€‚é…: QLabel æ›¿ä»£ ttk.Label
   - é€‚é…: setStyleSheet æ›¿ä»£ config()

3. **åˆ—å­—æ¯æ˜ å°„ç”Ÿæˆé€»è¾‘** (ä» update_preview æ–¹æ³•æå–)

#### é€‚é…å·¥ä½œ
- ç§»é™¤ ttkbootstrap çš„ `bootstyle` å±æ€§
- ä½¿ç”¨ PyQt6 çš„ `setStyleSheet()` è®¾ç½®æ ·å¼
- ä½¿ç”¨ QFont è®¾ç½®å­—ä½“
- ä½¿ç”¨ QFrame æ›¿ä»£ ttk.Frame

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. åˆ—é¡ºåºä¸€è‡´æ€§
- é¢„è§ˆè¡¨å¤´çš„åˆ—å­—æ¯é¡ºåºä¸æœ€ç»ˆå¯¼å‡ºExcelä¿æŒä¸€è‡´
- é€è§†åˆ—æŒ‰å­—æ¯é¡ºåºæ’åºï¼ˆA, B, C, ...ï¼‰

### 2. å…¬å¼å˜é‡æ˜ å°„
- **M**: æ‰‹å·¥æ•°é‡åˆ—
- **S**: ç³»ç»Ÿæ€»è®¡åˆ—
- **é€è§†åˆ—å**: ç›´æ¥ä½¿ç”¨åˆ—åï¼ˆå¦‚"å·²å®Œæˆ"ï¼‰
- **Excelå­—æ¯**: æ ¹æ®åˆ—åœ¨ç»“æœä¸­çš„ä½ç½®åˆ†é…

### 3. æ­£åˆ™æ›¿æ¢è§„åˆ™
ä½¿ç”¨ `\b` è¾¹ç•ŒåŒ¹é…ï¼Œé¿å…è¯¯æ›¿æ¢ï¼š
- `\bM\b` åªåŒ¹é…ç‹¬ç«‹çš„ Mï¼Œä¸åŒ¹é… "Manual" ä¸­çš„ M
- é€è§†åˆ—ä½¿ç”¨ `re.escape()` è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦

---

## ğŸ§ª æµ‹è¯•å»ºè®®

### æµ‹è¯•ç”¨ä¾‹1: ç®€å•å¯¹è´¦
- **å…¬å¼**: `M - S`
- **é¢„æœŸ**: æ˜¾ç¤º "C - D (M - S)"

### æµ‹è¯•ç”¨ä¾‹2: å•é€è§†åˆ—
- **å…¬å¼**: `M - (S - å·²å®Œæˆ)`
- **é¢„æœŸ**: æ˜¾ç¤º "B - (C - A) (M - (S - å·²å®Œæˆ))"

### æµ‹è¯•ç”¨ä¾‹3: å¤šé€è§†åˆ—
- **å…¬å¼**: `M - (A + B + C)`
- **é€è§†åˆ—**: å·²å®Œæˆã€å¤„ç†ä¸­ã€å¾…å®¡æ ¸
- **é¢„æœŸ**: æ˜¾ç¤º "D - (A + B + C)" å’Œåˆ—å¯¹ç…§

---

## ğŸ“– ç›¸å…³æ–‡æ¡£

- **å®Œæ•´é¡¹ç›®æ–‡æ¡£**: [PROJECT_OVERVIEW.md](PROJECT_OVERVIEW.md)
- **å¼€å‘çº¦æŸ**: [.github/copilot-instructions.md](.github/copilot-instructions.md)
- **ä¸Šä¸€ç‰ˆæœ¬**: [æ›´æ–°è¯´æ˜_v1.4.1.md](æ›´æ–°è¯´æ˜_v1.4.1.md)

---

**æ›´æ–°äººå‘˜**: GitHub Copilot (Claude Sonnet 4.5)  
**æ–‡æ¡£ç‰ˆæœ¬**: 1.0

