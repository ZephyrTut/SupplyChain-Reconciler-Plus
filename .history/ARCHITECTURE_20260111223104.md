# ğŸ—ï¸ ARCHITECTURE

**SupplyChain-Reconciler-Plus ç³»ç»Ÿæ¶æ„è®¾è®¡**

---

## ğŸ“ æ•´ä½“æ¶æ„

### åˆ†å±‚æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·ç•Œé¢å±‚ (UI)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ ä¸»çª—å£       â”‚ é…ç½®é¢æ¿     â”‚ ç»“æœé¢„è§ˆ     â”‚              â”‚
â”‚  â”‚ (QtMainWindow) â”‚ (QtConfigPanel) â”‚ (QtResultPreview) â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚            â†“  ä¿¡å·/æ§½           â†“  é…ç½®è·å–                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                       ä¸šåŠ¡é€»è¾‘å±‚ (Core)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  CompareEngine: æ•°æ®æ¯”å¯¹å¼•æ“                   â”‚          â”‚
â”‚  â”‚  - æ•°æ®æ¸…æ´—    - ä¸»é”®ç”Ÿæˆ   - èšåˆé€è§†        â”‚          â”‚
â”‚  â”‚  - æ¡ä»¶ç­›é€‰    - åˆå¹¶æ¯”å¯¹   - å·®å€¼è®¡ç®—        â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  ExportEngine: å¯¼å‡ºå¼•æ“                        â”‚          â”‚
â”‚  â”‚  - Excelå†™å…¥   - é¢œè‰²æ ‡è®°   - å¤šSheetå¤„ç†     â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚            â†“  æ•°æ®å¤„ç†          â†“  æ•°æ®ç»“æ„                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                       å·¥å…·å±‚ (Utils)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ Excelæ“ä½œ    â”‚ é…ç½®å­˜å‚¨     â”‚ Excelæ£€æµ‹    â”‚              â”‚
â”‚  â”‚ (excel_utils)â”‚ (storage)    â”‚(excel_detection)â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚            â†“  æ–‡ä»¶æ“ä½œ          â†“  ç³»ç»Ÿè°ƒç”¨                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    åŸºç¡€è®¾æ–½å±‚ (Infrastructure)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ æ–‡ä»¶ç³»ç»Ÿ     â”‚ æ•°æ®åº“       â”‚ æ“ä½œç³»ç»Ÿ     â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ æ¨¡å—ç»“æ„

### é¡¶çº§ç›®å½•

```
SupplyChain-Reconciler-Plus/
â”œâ”€â”€ main.py                    # åº”ç”¨å¯åŠ¨å…¥å£
â”œâ”€â”€ start.py                   # å¯åŠ¨èœå•ï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ config/                    # é…ç½®æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ settings.py           # å…¨å±€å¸¸é‡
â”œâ”€â”€ core/                      # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ compare_engine.py      # æ•°æ®æ¯”å¯¹å¼•æ“
â”‚   â””â”€â”€ export_engine.py       # Excelå¯¼å‡ºå¼•æ“
â”œâ”€â”€ ui/                        # ç”¨æˆ·ç•Œé¢
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ qt_main_window.py      # ä¸»çª—å£
â”‚   â”œâ”€â”€ qt_config_panel.py     # é…ç½®é¢æ¿
â”‚   â”œâ”€â”€ qt_result_preview.py   # ç»“æœé¢„è§ˆ
â”‚   â”œâ”€â”€ qt_dialogs.py          # å¯¹è¯æ¡†ç»„ä»¶
â”‚   â””â”€â”€ scroll_utils.py        # UIå·¥å…·ï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ utils/                     # å·¥å…·æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ excel_utils.py         # Excelè¯»å†™å·¥å…·
â”‚   â”œâ”€â”€ excel_detection.py     # æ´»åŠ¨Excelæ£€æµ‹
â”‚   â””â”€â”€ storage.py             # é…ç½®/æ¨¡æ¿å­˜å‚¨
â”œâ”€â”€ tests/                     # æµ‹è¯•æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ test_core.py
â”‚   â”œâ”€â”€ test_asn_export.py
â”‚   â”œâ”€â”€ test_template_*.py
â”‚   â””â”€â”€ README_TESTING.md
â”œâ”€â”€ docs/                      # è¯¦ç»†åŠŸèƒ½æ–‡æ¡£ï¼ˆ19ä»½ï¼‰
â”œâ”€â”€ exports/                   # å¯¼å‡ºç»“æœç›®å½•
â”œâ”€â”€ requirements.txt           # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ CHANGELOG.md              # ç‰ˆæœ¬å†å²
â”œâ”€â”€ ARCHITECTURE.md           # æœ¬æ–‡ä»¶
â”œâ”€â”€ AGENT.md                  # Agentçº¦æŸ
â””â”€â”€ ...å…¶ä»–æ–‡æ¡£
```

---

## ğŸ”„ æ•°æ®æµå‘

### å®Œæ•´å¯¹è´¦æµç¨‹

```
ç”¨æˆ·å¯¼å…¥ Excel
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: æ–‡ä»¶åŠ è½½                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. excel_utils.read_excel()            â”‚
â”‚    - è¯»å–Sheetå†…å®¹ä¸ºDataFrame         â”‚
â”‚    - è‡ªåŠ¨ç±»å‹æ¨æ–­                     â”‚
â”‚ 2. QtConfigPanel.set_sample_data()     â”‚
â”‚    - æ˜¾ç¤ºå‰5è¡Œæ•°æ®é¢„è§ˆ                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: é…ç½®å¤„ç†                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. QtConfigPanel.get_config()          â”‚
â”‚    - è·å–æ‰€æœ‰é…ç½®é¡¹                   â”‚
â”‚ 2. é…ç½®éªŒè¯                           â”‚
â”‚    - æ£€æŸ¥ä¸»é”®ã€æ•°å€¼åˆ—å¿…å¡«             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: æ•°æ®é¢„å¤„ç†                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. CompareEngine.clean_column()        â”‚
â”‚    - æ­£åˆ™æ¸…æ´—æ•°æ®                     â”‚
â”‚ 2. CompareEngine.apply_filters()       â”‚
â”‚    - åº”ç”¨ç­›é€‰æ¡ä»¶                     â”‚
â”‚ 3. CompareEngine.make_key()            â”‚
â”‚    - ç”Ÿæˆå¤åˆä¸»é”®                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: é€è§†èšåˆ                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. CompareEngine.aggregate_manual_*()  â”‚
â”‚    - æ‰‹å·¥è¡¨é€è§†+å‡ºå…¥åº“åŒºåˆ†            â”‚
â”‚ 2. CompareEngine.aggregate_system()    â”‚
â”‚    - ç³»ç»Ÿè¡¨é€è§†+çŠ¶æ€å±•å¼€              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: åˆå¹¶æ¯”å¯¹                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. CompareEngine.merge_and_compare()   â”‚
â”‚    - å·¦å¤–è¿æ¥(æ‰‹å·¥è¡¨ä¸ºä¸»)             â”‚
â”‚    - è®¡ç®—å·®å€¼                         â”‚
â”‚    - æ ‡è®°æ¯”å¯¹çŠ¶æ€                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 6: ç»“æœå¯¼å‡º                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. QtResultPreview.set_data()          â”‚
â”‚    - æ˜¾ç¤ºå‰15è¡Œé¢„è§ˆ                   â”‚
â”‚    - è®¡ç®—ç»Ÿè®¡ä¿¡æ¯                     â”‚
â”‚ 2. ExportEngine.export_results()       â”‚
â”‚    - ç”Ÿæˆå¸¦é¢œè‰²çš„Excel                â”‚
â”‚    - åˆ›å»ºå¤šä¸ªSheet                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
å¯¼å‡º Excel å®Œæˆ
```

---

## ğŸ”Œ æ¨¡å—æ¥å£

### CompareEngine å…¬å…±æ¥å£

```python
class CompareEngine:
    """æ•°æ®æ¯”å¯¹å¼•æ“"""
    
    # æ•°æ®å¤„ç†
    @staticmethod
    def clean_column(df, clean_rules) â†’ DataFrame
    
    @staticmethod
    def apply_filters(df, filters) â†’ DataFrame
    
    @staticmethod
    def make_key(df, key_cols, keyname) â†’ DataFrame
    
    # é€è§†èšåˆ
    @staticmethod
    def aggregate_manual_with_pivot(
        df, key_col, value_col, pivot_config, filters
    ) â†’ Tuple[DataFrame, List, List]
    
    @staticmethod
    def aggregate_system(
        df, key_col, value_cols, pivot_column, filters
    ) â†’ Tuple[DataFrame, List]
    
    # æ ¸å¿ƒå¯¹è´¦
    @staticmethod
    def merge_and_compare(
        manual_df, system_df, key_col, formula, pivot_values
    ) â†’ DataFrame
```

### ExportEngine å…¬å…±æ¥å£

```python
class ExportEngine:
    """Excelå¯¼å‡ºå¼•æ“"""
    
    @staticmethod
    def export_results(
        out_path, result_df, pivot_values, config_info
    ) â†’ None
```

### QtConfigPanel å…¬å…±æ¥å£

```python
class QtConfigPanel(QWidget):
    """é…ç½®é¢æ¿"""
    
    def get_config(self) â†’ dict
    def set_config(self, config) â†’ None
    def refresh_columns(self, manual_cols, system_cols) â†’ None
```

---

## ğŸ’¾ æ•°æ®ç»“æ„

### æ ¸å¿ƒæ•°æ®æ¨¡å‹

#### 1. é…ç½®å¯¹è±¡ (Config)

```python
{
    "key_mappings": [
        {"manual_col": str, "system_col": str},
        ...
    ],
    "value_mapping": {
        "manual_col": str,
        "system_col": str
    },
    "clean_rules": [
        {
            "column": str,
            "mode": str,  # "åˆ é™¤åŒ¹é…"|"ä¿ç•™åŒ¹é…"|"æ›¿æ¢ä¸º"
            "regexes": [str],
            "replace": str
        },
        ...
    ],
    "manual_filters": [...],
    "system_filters": [...],
    "manual_pivot_config": {
        "enabled": bool,
        "pivot_column": str,
        "out_values": [str],
        "in_values": [str]
    },
    "system_pivot_config": {
        "enabled": bool,
        "pivot_column": str
    },
    "difference_formula": str
}
```

#### 2. ç»“æœæ•°æ® (Result DataFrame)

```
| __KEY__ | é€è§†åˆ—1 | é€è§†åˆ—2 | ç³»ç»Ÿæ€»è®¡ | æ‰‹å·¥æ•°é‡ | å·®å€¼ | æ¯”å¯¹çŠ¶æ€ |
|---------|--------|--------|---------|---------|------|---------|
| str     | num    | num    | num     | num     | num  | str     |
```

#### 3. æ¨¡æ¿å¯¹è±¡ (Template)

```python
{
    "id": str,  # UUID
    "name": str,
    "config": {...},  # åŒä¸ŠConfig
    "timestamp": str
}
```

---

## ğŸ” è®¾è®¡åŸåˆ™

### 1. åˆ†å±‚æ¸…æ™°

```
è§„åˆ™: 
- UI â†’ Core â†’ Utils (å•å‘ä¾èµ–)
- Core ä¸ä¾èµ– UI
- Utils ä¸ä¾èµ– UI å’Œ Core
```

**å¥½å¤„**:
- ä»£ç è€¦åˆåº¦ä½
- æ˜“äºæµ‹è¯•
- æ˜“äºç»´æŠ¤

### 2. å•ä¸€èŒè´£

```
æ¯ä¸ªæ¨¡å—åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½:
- CompareEngine: åªåšæ•°æ®æ¯”å¯¹
- ExportEngine: åªåšExcelå¯¼å‡º
- excel_utils: åªåšExcelè¯»å†™
- storage: åªåšé…ç½®å­˜å‚¨
```

### 3. ä¸å¯å˜æ•°æ®æµ

```python
# æ­£ç¡®ï¼šæ“ä½œåè¿”å›æ–°å¯¹è±¡
result = df.merge(other_df).copy()

# é¿å…ï¼šç›´æ¥ä¿®æ”¹åŸå¯¹è±¡
df.merge(other_df, inplace=True)
```

### 4. æ˜¾å¼é…ç½®

```python
# æ­£ç¡®ï¼šæ‰€æœ‰é…ç½®é€šè¿‡å‚æ•°ä¼ é€’
pivot_df = aggregate_system(df, config=pivot_config)

# é¿å…ï¼šä½¿ç”¨éšè—çš„å…¨å±€çŠ¶æ€
pivot_df = aggregate_system(df)  # ä¾èµ–å…¨å±€å˜é‡
```

---

## ğŸ”„ å…³é”®äº¤äº’æµ

### æ–‡ä»¶å¯¼å…¥æµç¨‹

```
ç”¨æˆ·æ‹–æ‹½æ–‡ä»¶æˆ–ç‚¹å‡»é€‰æ‹©
     â†“
QtMainWindow._on_select_file()
     â†“
excel_utils.get_sheet_names()
     â†“
æ›´æ–° Sheet ä¸‹æ‹‰æ¡†
     â†“
excel_utils.read_excel_preview()
     â†“
QtConfigPanel.set_sample_data()
```

### é…ç½®ä¿å­˜æµç¨‹

```
ç”¨æˆ·ç‚¹å‡»"ä¿å­˜æ¨¡æ¿"
     â†“
InputDialog è·å–æ¨¡æ¿åç§°
     â†“
QtConfigPanel.get_config()
     â†“
storage.save_template(name, config)
     â†“
å†™å…¥ templates.json
     â†“
åˆ·æ–°æ¨¡æ¿ä¸‹æ‹‰æ¡†
```

### å¯¹è´¦æ‰§è¡Œæµç¨‹

```
ç”¨æˆ·ç‚¹å‡»"æ‰§è¡Œå¯¹è´¦"
     â†“
éªŒè¯é…ç½®å®Œæ•´æ€§
     â†“
è¯»å–ä¸¤ä¸ªæ–‡ä»¶
     â†“
CompareEngine.merge_and_compare()
     â†“
QtResultPreview.set_data()
     â†“
æ˜¾ç¤ºé¢„è§ˆ + ç»Ÿè®¡
```

---

## ğŸš€ æ‰©å±•ç‚¹

### 1. æ–°å¢ç­›é€‰æ“ä½œç¬¦

```
ä½ç½®: core/compare_engine.py
ä¿®æ”¹ OPERATOR_MAP å¸¸é‡
```

### 2. æ–°å¢æ•°æ®æ¸…æ´—æ¨¡å¼

```
ä½ç½®: core/compare_engine.py
ä¿®æ”¹ clean_column() æ–¹æ³•
```

### 3. æ–°å¢å¯¼å‡ºæ ¼å¼

```
ä½ç½®: core/export_engine.py
åˆ›å»ºæ–°çš„ export_* æ–¹æ³•
```

### 4. æ–°å¢UIç»„ä»¶

```
ä½ç½®: ui/qt_dialogs.py
åˆ›å»ºæ–°çš„ Dialog ç±»
```

---

## ğŸ“Š ä¾èµ–å…³ç³»å›¾

```
main.py
  â†“
QtMainWindow
  â”œâ†’ QtConfigPanel
  â”‚   â”œâ†’ CompareEngine (è¯»å–é…ç½®åè°ƒç”¨)
  â”‚   â””â†’ excel_utils
  â”œâ†’ QtResultPreview
  â”‚   â””â†’ CompareEngine (è·å–ç»“æœåå¤„ç†)
  â”œâ†’ ExportEngine
  â”‚   â””â†’ openpyxl
  â””â†’ storage
      â””â†’ json

CompareEngine
  â”œâ†’ pandas
  â”œâ†’ re (æ­£åˆ™)
  â””â†’ utils

ExportEngine
  â”œâ†’ openpyxl
  â””â†’ config.settings (é¢œè‰²é…ç½®)

excel_utils
  â”œâ†’ pandas
  â”œâ†’ openpyxl
  â””â†’ xlrd

storage
  â”œâ†’ json
  â”œâ†’ uuid
  â””â†’ pathlib
```

---

## ğŸ’¡ è®¾è®¡å†³ç­–

### ä¸ºä»€ä¹ˆä½¿ç”¨ pandas?
- æ•°æ®å¤„ç†å¼ºå¤§
- å†…å­˜æ•ˆç‡é«˜
- APIæ˜“ç”¨

### ä¸ºä»€ä¹ˆåˆ†ç¦» Core å’Œ UI?
- ä¾¿äºå•å…ƒæµ‹è¯•
- ä¾¿äºå¤ç”¨ï¼ˆå¦‚CLI/APIï¼‰
- ä»£ç ç»´æŠ¤æ€§å¥½

### ä¸ºä»€ä¹ˆä½¿ç”¨ JSON å­˜å‚¨æ¨¡æ¿?
- è½»é‡çº§ï¼Œæ˜“äºå¤‡ä»½
- äººç±»å¯è¯»
- è·¨å¹³å°æ”¯æŒ

### ä¸ºä»€ä¹ˆé™åˆ¶é¢„è§ˆä¸º 15 è¡Œ?
- é˜²æ­¢å¤§æ•°æ®é‡å¯¼è‡´UIå¡é¡¿
- è¶³å¤Ÿç”¨æˆ·éªŒè¯é…ç½®
- å®Œæ•´æ•°æ®åœ¨å¯¼å‡ºä¸­ä¿ç•™

---

## ğŸ”§ æ€§èƒ½è€ƒè™‘

### ç“¶é¢ˆåˆ†æ

| æ“ä½œ | ç“¶é¢ˆ | ä¼˜åŒ–ç­–ç•¥ |
|------|------|---------|
| è¯»å–å¤§æ–‡ä»¶ | I/O | pandasä¼˜åŒ– |
| é€è§†æ“ä½œ | å†…å­˜ | é™åˆ¶è¡Œæ•° |
| Excelå¯¼å‡º | openpyxlå†™å…¥ | æµå¼å†™å…¥ |
| æ¨¡æ¿æ“ä½œ | JSONåºåˆ—åŒ– | å¢é‡æ›´æ–° |

### ä¼˜åŒ–å»ºè®®

1. **åˆ†æ‰¹å¤„ç†**: è¶…è¿‡10ä¸‡è¡Œå»ºè®®åˆ†æ‰¹
2. **æ‡’åŠ è½½**: é¢„è§ˆä½¿ç”¨head()
3. **ç¼“å­˜**: é‡å¤æ“ä½œçš„ä¸­é—´ç»“æœ
4. **å¼‚æ­¥**: é•¿æ“ä½œä½¿ç”¨åŠ è½½åŠ¨ç”»

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ ¸å¿ƒå¼•æ“API](docs/14-æ ¸å¿ƒå¼•æ“API.md)
- [UIç»„ä»¶API](docs/15-UIç»„ä»¶API.md)
- [å·¥å…·å‡½æ•°API](docs/16-å·¥å…·å‡½æ•°API.md)
- [å¼€å‘çº¦æŸ](AGENT.md)

---

**æœ€åæ›´æ–°**: 2026å¹´1æœˆ11æ—¥  
**æ–‡æ¡£ç‰ˆæœ¬**: 1.4.3
